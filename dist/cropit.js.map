{"version":3,"sources":["../src/cropit.js"],"names":["Cropit","jQuery","element","options","$el","defaults","extend","init","image","Image","preImage","onload","onImageLoaded","bind","onPreImageLoaded","onerror","onImageError","call","IMAGE_FAILED_TO_LOAD","$preview","css","$fileInput","attr","accept","$zoomSlider","min","max","step","previewSize","width","innerWidth","height","innerHeight","$image","addClass","PREVIEW_IMAGE","transformOrigin","webkitTransformOrigin","willChange","$imageContainer","PREVIEW_IMAGE_CONTAINER","position","overflow","left","top","append","imageBackground","isArray","imageBackgroundBorderWidth","bgBorderWidthArray","map","$bg","PREVIEW_BACKGROUND","$bgContainer","PREVIEW_BACKGROUND_CONTAINER","zIndex","right","bottom","prepend","initialZoom","imageLoaded","moveContinue","zoomer","allowDragNDrop","event","props","push","bindListeners","imageState","src","loadImage","on","onFileChange","PREVIEW","onPreviewEvent","ZOOM_INPUT","onZoomSliderChange","onDragOver","onDrop","off","e","get","files","loadFile","file","fileReader","FileReader","type","match","readAsDataURL","onFileReaderLoaded","onFileReaderError","target","result","preventDefault","dataTransfer","dropEffect","toggleClass","DRAG_HOVERED","stopPropagation","Array","prototype","slice","some","removeClass","imageSrc","onImageLoading","setImageLoadingClass","indexOf","xhr","XMLHttpRequest","status","response","open","responseType","send","shouldRejectImage","imageWidth","imageHeight","maxZoom","exportZoom","smallImage","SMALL_IMAGE","setImageLoadedClass","rotation","setupZoomer","zoom","_initialZoom","offset","centerImage","apply","arguments","removeImageLoadingClass","IMAGE_LOADED","IMAGE_LOADING","originalEvent","touches","clientX","clientY","x","y","PREVIEW_MOVE","origin","getEventPosition","onMove","document","body","focus","eventPosition","ret","freeMove","Math","zoomSliderPos","Number","val","newZoom","getZoom","removeAttr","onZoomEnabled","onZoomDisabled","setup","imageSize","minZoom","_zoom","isZoomable","enableZoomSlider","disableZoomSlider","fixZoom","transformation","rotatedOffset","transform","webkitTransform","exportOptions","exportDefaults","quality","originalSize","fillBg","zoomedSize","canvas","canvasContext","getContext","fillStyle","fillRect","translate","rotate","PI","drawImage","toDataURL","unbindListeners","DISABLED","selector","find","_offset","fixOffset","renderImage","onOffsetChange","oldZoom","newX","newY","getSliderPos","onZoomChange","newRotation","_rotation","initialZoomOption","_previewSize","size"],"mappings":"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","file":"cropit.js","sourcesContent":["import $ from 'jquery';\n\nimport Zoomer from './zoomer';\nimport { CLASS_NAMES, ERRORS, EVENTS } from './constants';\nimport { loadDefaults } from './options';\nimport { exists, round } from './utils';\n\nclass Cropit {\n  constructor(jQuery, element, options) {\n    this.$el = $(element);\n\n    const defaults = loadDefaults(this.$el);\n    this.options = $.extend({}, defaults, options);\n\n    this.init();\n  }\n\n  init() {\n    this.image = new Image();\n    this.preImage = new Image();\n    this.image.onload = this.onImageLoaded.bind(this);\n    this.preImage.onload = this.onPreImageLoaded.bind(this);\n    this.image.onerror = this.preImage.onerror = () => {\n      this.onImageError.call(this, ERRORS.IMAGE_FAILED_TO_LOAD);\n    };\n\n    this.$preview = this.options.$preview.css('position', 'relative');\n    this.$fileInput = this.options.$fileInput.attr({ accept: 'image/*' });\n    this.$zoomSlider = this.options.$zoomSlider.attr({ min: 0, max: 1, step: 0.01 });\n\n    this.previewSize = {\n      width: this.options.width || this.$preview.innerWidth(),\n      height: this.options.height || this.$preview.innerHeight(),\n    };\n\n    this.$image = $('<img />')\n      .addClass(CLASS_NAMES.PREVIEW_IMAGE)\n      .attr('alt', '')\n      .css({\n        transformOrigin: 'top left',\n        webkitTransformOrigin: 'top left',\n        willChange: 'transform',\n      });\n    this.$imageContainer = $('<div />')\n      .addClass(CLASS_NAMES.PREVIEW_IMAGE_CONTAINER)\n      .css({\n        position: 'absolute',\n        overflow: 'hidden',\n        left: 0,\n        top: 0,\n        width: '100%',\n        height: '100%',\n      })\n      .append(this.$image);\n    this.$preview.append(this.$imageContainer);\n\n    if (this.options.imageBackground) {\n      if ($.isArray(this.options.imageBackgroundBorderWidth)) {\n        this.bgBorderWidthArray = this.options.imageBackgroundBorderWidth;\n      }\n      else {\n        this.bgBorderWidthArray = [0, 1, 2, 3].map(() => this.options.imageBackgroundBorderWidth);\n      }\n\n      this.$bg = $('<img />')\n        .addClass(CLASS_NAMES.PREVIEW_BACKGROUND)\n        .attr('alt', '')\n        .css({\n          position: 'relative',\n          left: this.bgBorderWidthArray[3],\n          top: this.bgBorderWidthArray[0],\n          transformOrigin: 'top left',\n          webkitTransformOrigin: 'top left',\n          willChange: 'transform',\n        });\n      this.$bgContainer = $('<div />')\n        .addClass(CLASS_NAMES.PREVIEW_BACKGROUND_CONTAINER)\n        .css({\n          position: 'absolute',\n          zIndex: 0,\n          top: -this.bgBorderWidthArray[0],\n          right: -this.bgBorderWidthArray[1],\n          bottom: -this.bgBorderWidthArray[2],\n          left: -this.bgBorderWidthArray[3],\n        })\n        .append(this.$bg);\n      if (this.bgBorderWidthArray[0] > 0) {\n        this.$bgContainer.css('overflow', 'hidden');\n      }\n      this.$preview.prepend(this.$bgContainer);\n    }\n\n    this.initialZoom = this.options.initialZoom;\n\n    this.imageLoaded = false;\n\n    this.moveContinue = false;\n\n    this.zoomer = new Zoomer();\n\n    if (this.options.allowDragNDrop) {\n      $.event.props.push('dataTransfer');\n    }\n\n    this.bindListeners();\n\n    if (this.options.imageState && this.options.imageState.src) {\n      this.loadImage(this.options.imageState.src);\n    }\n  }\n\n  bindListeners() {\n    this.$fileInput.on('change.cropit', this.onFileChange.bind(this));\n    this.$imageContainer.on(EVENTS.PREVIEW, this.onPreviewEvent.bind(this));\n    this.$zoomSlider.on(EVENTS.ZOOM_INPUT, this.onZoomSliderChange.bind(this));\n\n    if (this.options.allowDragNDrop) {\n      this.$imageContainer.on('dragover.cropit dragleave.cropit', this.onDragOver.bind(this));\n      this.$imageContainer.on('drop.cropit', this.onDrop.bind(this));\n    }\n  }\n\n  unbindListeners() {\n    this.$fileInput.off('change.cropit');\n    this.$imageContainer.off(EVENTS.PREVIEW);\n    this.$imageContainer.off('dragover.cropit dragleave.cropit drop.cropit');\n    this.$zoomSlider.off(EVENTS.ZOOM_INPUT);\n  }\n\n  onFileChange(e) {\n    this.options.onFileChange(e);\n\n    if (this.$fileInput.get(0).files) {\n      this.loadFile(this.$fileInput.get(0).files[0]);\n    }\n  }\n\n  loadFile(file) {\n    const fileReader = new FileReader();\n    if (file && file.type.match('image')) {\n      fileReader.readAsDataURL(file);\n      fileReader.onload = this.onFileReaderLoaded.bind(this);\n      fileReader.onerror = this.onFileReaderError.bind(this);\n    }\n    else if (file) {\n      this.onFileReaderError();\n    }\n  }\n\n  onFileReaderLoaded(e) {\n    this.loadImage(e.target.result);\n  }\n\n  onFileReaderError() {\n    this.options.onFileReaderError();\n  }\n\n  onDragOver(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n    this.$preview.toggleClass(CLASS_NAMES.DRAG_HOVERED, e.type === 'dragover');\n  }\n\n  onDrop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const files = Array.prototype.slice.call(e.dataTransfer.files, 0);\n    files.some((file) => {\n      if (!file.type.match('image')) { return false; }\n\n      this.loadFile(file);\n      return true;\n    });\n\n    this.$preview.removeClass(CLASS_NAMES.DRAG_HOVERED);\n  }\n\n  loadImage(imageSrc) {\n    if (!imageSrc) { return; }\n\n    this.options.onImageLoading();\n    this.setImageLoadingClass();\n\n    if (imageSrc.indexOf('data') === 0) {\n      this.preImage.src = imageSrc;\n    }\n    else {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = (e) => {\n        if (e.target.status >= 300) {\n          this.onImageError.call(this, ERRORS.IMAGE_FAILED_TO_LOAD);\n          return;\n        }\n\n        this.loadFile(e.target.response);\n      };\n      xhr.open('GET', imageSrc);\n      xhr.responseType = 'blob';\n      xhr.send();\n    }\n  }\n\n  onPreImageLoaded() {\n    if (this.shouldRejectImage({\n      imageWidth: this.preImage.width,\n      imageHeight: this.preImage.height,\n      previewSize: this.previewSize,\n      maxZoom: this.options.maxZoom,\n      exportZoom: this.options.exportZoom,\n      smallImage: this.options.smallImage,\n    })) {\n      this.onImageError(ERRORS.SMALL_IMAGE);\n      if (this.image.src) { this.setImageLoadedClass(); }\n      return;\n    }\n\n    this.image.src = this.preImage.src;\n  }\n\n  onImageLoaded() {\n    this.rotation = 0;\n    this.setupZoomer(this.options.imageState && this.options.imageState.zoom || this._initialZoom);\n    if (this.options.imageState && this.options.imageState.offset) {\n      this.offset = this.options.imageState.offset;\n    }\n    else {\n      this.centerImage();\n    }\n\n    this.options.imageState = {};\n\n    this.$image.attr('src', this.image.src);\n    if (this.options.imageBackground) {\n      this.$bg.attr('src', this.image.src);\n    }\n\n    this.setImageLoadedClass();\n\n    this.imageLoaded = true;\n\n    this.options.onImageLoaded();\n  }\n\n  onImageError() {\n    this.options.onImageError.apply(this, arguments);\n    this.removeImageLoadingClass();\n  }\n\n  setImageLoadingClass() {\n    this.$preview\n      .removeClass(CLASS_NAMES.IMAGE_LOADED)\n      .addClass(CLASS_NAMES.IMAGE_LOADING);\n  }\n\n  setImageLoadedClass() {\n    this.$preview\n      .removeClass(CLASS_NAMES.IMAGE_LOADING)\n      .addClass(CLASS_NAMES.IMAGE_LOADED);\n  }\n\n  removeImageLoadingClass() {\n    this.$preview\n      .removeClass(CLASS_NAMES.IMAGE_LOADING);\n  }\n\n  getEventPosition(e) {\n    if (e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0]) {\n      e = e.originalEvent.touches[0];\n    }\n    if (e.clientX && e.clientY) {\n      return { x: e.clientX, y: e.clientY };\n    }\n  }\n\n  onPreviewEvent(e) {\n    if (!this.imageLoaded) { return; }\n\n    this.moveContinue = false;\n    this.$imageContainer.off(EVENTS.PREVIEW_MOVE);\n\n    if (e.type === 'mousedown' || e.type === 'touchstart') {\n      this.origin = this.getEventPosition(e);\n      this.moveContinue = true;\n      this.$imageContainer.on(EVENTS.PREVIEW_MOVE, this.onMove.bind(this));\n    }\n    else {\n      $(document.body).focus();\n    }\n\n    e.stopPropagation();\n    return false;\n  }\n\n  onMove(e) {\n    const eventPosition = this.getEventPosition(e);\n\n    if (this.moveContinue && eventPosition) {\n      this.offset = {\n        x: this.offset.x + eventPosition.x - this.origin.x,\n        y: this.offset.y + eventPosition.y - this.origin.y,\n      };\n    }\n\n    this.origin = eventPosition;\n\n    e.stopPropagation();\n    return false;\n  }\n\n  set offset(position) {\n    if (!position || !exists(position.x) || !exists(position.y)) { return; }\n\n    this._offset = this.fixOffset(position);\n    this.renderImage();\n\n    this.options.onOffsetChange(position);\n  }\n\n  fixOffset(offset) {\n    if (!this.imageLoaded) { return offset; }\n\n    const ret = { x: offset.x, y: offset.y };\n\n    if (!this.options.freeMove) {\n      if (this.imageWidth * this.zoom >= this.previewSize.width) {\n        ret.x = Math.min(0, Math.max(ret.x,\n          this.previewSize.width - this.imageWidth * this.zoom));\n      }\n      else {\n        ret.x = Math.max(0, Math.min(ret.x,\n          this.previewSize.width - this.imageWidth * this.zoom));\n      }\n\n      if (this.imageHeight * this.zoom >= this.previewSize.height) {\n        ret.y = Math.min(0, Math.max(ret.y,\n          this.previewSize.height - this.imageHeight * this.zoom));\n      }\n      else {\n        ret.y = Math.max(0, Math.min(ret.y,\n          this.previewSize.height - this.imageHeight * this.zoom));\n      }\n    }\n\n    ret.x = round(ret.x);\n    ret.y = round(ret.y);\n\n    return ret;\n  }\n\n  centerImage() {\n    if (!this.image.width || !this.image.height || !this.zoom) { return; }\n\n    this.offset = {\n      x: (this.previewSize.width - this.imageWidth * this.zoom) / 2,\n      y: (this.previewSize.height - this.imageHeight * this.zoom) / 2,\n    };\n  }\n\n  onZoomSliderChange() {\n    if (!this.imageLoaded) { return; }\n\n    this.zoomSliderPos = Number(this.$zoomSlider.val());\n    const newZoom = this.zoomer.getZoom(this.zoomSliderPos);\n    if (newZoom === this.zoom) { return; }\n    this.zoom = newZoom;\n  }\n\n  enableZoomSlider() {\n    this.$zoomSlider.removeAttr('disabled');\n    this.options.onZoomEnabled();\n  }\n\n  disableZoomSlider() {\n    this.$zoomSlider.attr('disabled', true);\n    this.options.onZoomDisabled();\n  }\n\n  setupZoomer(zoom) {\n    this.zoomer.setup({\n      imageSize: this.imageSize,\n      previewSize: this.previewSize,\n      exportZoom: this.options.exportZoom,\n      maxZoom: this.options.maxZoom,\n      minZoom: this.options.minZoom,\n      smallImage: this.options.smallImage,\n    });\n    this.zoom = exists(zoom) ? zoom : this._zoom;\n\n    if (this.isZoomable()) {\n      this.enableZoomSlider();\n    }\n    else {\n      this.disableZoomSlider();\n    }\n  }\n\n  set zoom(newZoom) {\n    newZoom = this.fixZoom(newZoom);\n\n    if (this.imageLoaded) {\n      const oldZoom = this.zoom;\n\n      const newX = this.previewSize.width / 2 - (this.previewSize.width / 2 - this.offset.x) * newZoom / oldZoom;\n      const newY = this.previewSize.height / 2 - (this.previewSize.height / 2 - this.offset.y) * newZoom / oldZoom;\n\n      this._zoom = newZoom;\n      this.offset = { x: newX, y: newY }; // Triggers renderImage()\n    }\n    else {\n      this._zoom = newZoom;\n    }\n\n    this.zoomSliderPos = this.zoomer.getSliderPos(this.zoom);\n    this.$zoomSlider.val(this.zoomSliderPos);\n\n    this.options.onZoomChange(newZoom);\n  }\n\n  fixZoom(zoom) {\n    return this.zoomer.fixZoom(zoom);\n  }\n\n  isZoomable() {\n    return this.zoomer.isZoomable();\n  }\n\n  get rotatedOffset() {\n    return {\n      x: this.offset.x +\n          (this.rotation === 90 ? this.image.height * this.zoom : 0) +\n          (this.rotation === 180 ? this.image.width * this.zoom : 0),\n      y: this.offset.y +\n          (this.rotation === 180 ? this.image.height * this.zoom : 0) +\n          (this.rotation === 270 ? this.image.width * this.zoom : 0),\n    };\n  }\n\n  renderImage() {\n    const transformation = `\n      translate(${this.rotatedOffset.x}px, ${this.rotatedOffset.y}px)\n      scale(${this.zoom})\n      rotate(${this.rotation}deg)`;\n\n    this.$image.css({\n      transform: transformation,\n      webkitTransform: transformation,\n    });\n    if (this.options.imageBackground) {\n      this.$bg.css({\n        transform: transformation,\n        webkitTransform: transformation,\n      });\n    }\n  }\n\n  set rotation(newRotation) {\n    this._rotation = newRotation;\n\n    if (this.imageLoaded) {\n      // Change in image size may lead to change in zoom range\n      this.setupZoomer();\n    }\n  }\n\n  get rotation() {\n    return this._rotation;\n  }\n\n  rotateCW() {\n    if (this.shouldRejectImage({\n      imageWidth: this.image.height,\n      imageHeight: this.image.width,\n      previewSize: this.previewSize,\n      maxZoom: this.options.maxZoom,\n      exportZoom: this.options.exportZoom,\n      smallImage: this.options.smallImage,\n    })) {\n      this.rotation = (this.rotation + 180) % 360;\n    }\n    else {\n      this.rotation = (this.rotation + 90) % 360;\n    }\n  }\n\n  rotateCCW() {\n    if (this.shouldRejectImage({\n      imageWidth: this.image.height,\n      imageHeight: this.image.width,\n      previewSize: this.previewSize,\n      maxZoom: this.options.maxZoom,\n      exportZoom: this.options.exportZoom,\n      smallImage: this.options.smallImage,\n    })) {\n      this.rotation = (this.rotation + 180) % 360;\n    }\n    else {\n      this.rotation = (this.rotation + 270) % 360;\n    }\n  }\n\n  shouldRejectImage({ imageWidth, imageHeight, previewSize, maxZoom, exportZoom, smallImage }) {\n    if (smallImage !== 'reject') { return false; }\n\n    return imageWidth * maxZoom < previewSize.width * exportZoom ||\n           imageHeight * maxZoom < previewSize.height * exportZoom;\n  }\n\n  getCroppedImageData(exportOptions) {\n    if (!this.image.src) { return; }\n\n    const exportDefaults = {\n      type: 'image/png',\n      quality: 0.75,\n      originalSize: false,\n      fillBg: '#fff',\n    };\n    exportOptions = $.extend({}, exportDefaults, exportOptions);\n\n    const exportZoom = exportOptions.originalSize ? 1 / this.zoom : this.options.exportZoom;\n\n    const zoomedSize = {\n      width: this.zoom * exportZoom * this.image.width,\n      height: this.zoom * exportZoom * this.image.height,\n    };\n\n    const canvas = $('<canvas />')\n      .attr({\n        width: this.previewSize.width * exportZoom,\n        height: this.previewSize.height * exportZoom,\n      })\n      .get(0);\n    const canvasContext = canvas.getContext('2d');\n\n    if (exportOptions.type === 'image/jpeg') {\n      canvasContext.fillStyle = exportOptions.fillBg;\n      canvasContext.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    canvasContext.translate(\n      this.rotatedOffset.x * exportZoom,\n      this.rotatedOffset.y * exportZoom);\n    canvasContext.rotate(this.rotation * Math.PI / 180);\n    canvasContext.drawImage(this.image,\n      0, 0,\n      zoomedSize.width,\n      zoomedSize.height);\n\n    return canvas.toDataURL(exportOptions.type, exportOptions.quality);\n  }\n\n  get imageState() {\n    return {\n      src: this.image.src,\n      offset: this.offset,\n      zoom: this.zoom,\n    };\n  }\n\n  get imageSrc() {\n    return this.image.src;\n  }\n\n  set imageSrc(imageSrc) {\n    this.loadImage(imageSrc);\n  }\n\n  get offset() {\n    return this._offset;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get imageWidth() {\n    return this.rotation % 180 === 0 ? this.image.width : this.image.height;\n  }\n\n  get imageHeight() {\n    return this.rotation % 180 === 0 ? this.image.height : this.image.width;\n  }\n\n  get imageSize() {\n    return {\n      width: this.imageWidth,\n      height: this.imageHeight,\n    };\n  }\n\n  get initialZoom() {\n    return this.options.initialZoom;\n  }\n\n  set initialZoom(initialZoomOption) {\n    this.options.initialZoom = initialZoomOption;\n    if (initialZoomOption === 'min') {\n      this._initialZoom = 0; // Will be fixed when image loads\n    }\n    else if (initialZoomOption === 'image') {\n      this._initialZoom = 1;\n    }\n    else {\n      this._initialZoom = 0;\n    }\n  }\n\n  get exportZoom() {\n    return this.options.exportZoom;\n  }\n\n  set exportZoom(exportZoom) {\n    this.options.exportZoom = exportZoom;\n    this.setupZoomer();\n  }\n\n  get minZoom() {\n    return this.options.minZoom;\n  }\n\n  set minZoom(minZoom) {\n    this.options.minZoom = minZoom;\n    this.setupZoomer();\n  }\n\n  get maxZoom() {\n    return this.options.maxZoom;\n  }\n\n  set maxZoom(maxZoom) {\n    this.options.maxZoom = maxZoom;\n    this.setupZoomer();\n  }\n\n  get previewSize() {\n    return this._previewSize;\n  }\n\n  set previewSize(size) {\n    if (!size || size.width <= 0 || size.height <= 0) { return; }\n\n    this._previewSize = {\n      width: size.width,\n      height: size.height,\n    };\n    this.$preview\n      .innerWidth(this.previewSize.width)\n      .innerHeight(this.previewSize.height);\n\n    if (this.imageLoaded) {\n      this.setupZoomer();\n    }\n  }\n\n  disable() {\n    this.unbindListeners();\n    this.disableZoomSlider();\n    this.$el.addClass(CLASS_NAMES.DISABLED);\n  }\n\n  reenable() {\n    this.bindListeners();\n    this.enableZoomSlider();\n    this.$el.removeClass(CLASS_NAMES.DISABLED);\n  }\n\n  $(selector) {\n    if (!this.$el) { return null; }\n    return this.$el.find(selector);\n  }\n}\n\nexport default Cropit;\n"]}